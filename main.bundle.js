module.exports=function(e){function n(t){if(o[t])return o[t].exports;var r=o[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,n),r.l=!0,r.exports}var o={};return n.m=e,n.c=o,n.d=function(e,o,t){n.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:t})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(o,"a",o),o},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=5)}([function(e){e.exports=require("electron")},function(e){e.exports=require("original-fs")},function(e){e.exports=require("fs")},function(e){e.exports=require("url")},function(e){e.exports=require("path")},function(e,n,o){function t(){(x=new u({width:1024,height:768,titleBarStyle:"hidden",frame:!0})).loadURL(f.format({pathname:p.join(__dirname,"/index/loading.html"),protocol:"file:",slashes:!0})),global.mainWindow=x,global.appVersion=l.getVersion(),x.webContents.openDevTools(),a(function(e){e?x.loadURL(f.format({pathname:p.join(__dirname,"/index/update.html"),protocol:"file:",slashes:!0})):x.loadURL(f.format({pathname:p.join(__dirname,"/index/index.html"),protocol:"file:",slashes:!0}))}),x.on("closed",function(){x=null}),x.on("focus",function(){x.webContents.send("mainWindow-focus")})}function r(){S||(S=new u({frame:!1,modal:!0,transparent:!0,show:!1,width:0,height:0,alwaysOnTop:!0})).on("closed",function(){S=null}),S.loadURL(f.format({pathname:p.join(__dirname,"/recent/showCapture.html"),protocol:"file:",slashes:!0}))}function i(e,n){for(var o=e.split("."),t=n.split("."),r=0;3>r;r++){var i=parseInt(o[r]),a=parseInt(t[r]);if(i>a)return 1;if(i!=a)return-1}return 0}function a(e){let n=g.request("https://raw.githubusercontent.com/tracelessman/traceless-desk/publish/upgrade.json");n.on("response",n=>{let o="";200==n.statusCode?(n.on("data",e=>{o+=e}),n.on("end",()=>{let n=JSON.parse(o);if(1==i(j=n.version,l.getVersion())){C=!0,e(!0);let o=n.changeList;k=["package.json"];for(var t,r=0;r<o.length;r++)if(1==i((t=o[r]).version,l.getVersion())){t.files.forEach(function(e){-1==k.indexOf(e)&&k.push(e)})}}else e(!1)})):(e(!1),console.info("check update response.statusCode:"+n.statusCode))}),n.on("error",function(n){e(!1),console.info(n.toString())}),n.end()}function s(e){function n(e,n){R.set(e,n),global.upgradeMessage=function(){var e="";return R.forEach(function(n,o){e+=o+"---------------------"+n+"<br>"}),e}(),x.webContents.executeJavaScript("update()")}function o(e){if(h.existsSync(e)){h.readdirSync(e).forEach(function(n){var t=p.join(e,n);h.statSync(t).isDirectory()&&!t.endsWith(".asar")?o(t):h.unlinkSync(t)});try{h.rmdirSync(e)}catch(n){h.readdirSync(e).forEach(function(e){w.showMessageBox({message:e})})}}}var t="https://raw.githubusercontent.com/tracelessman/traceless-desk/publish/",r=t.length,i=0,a=0,s=p.join(__dirname,"_tmp");o(s),x.webContents.session.on("will-download",(t,c)=>{var l=c.getURL().substring(r);c.setSavePath(p.join(s,l)),c.on("updated",(e,o)=>{"interrupted"===o?n(l,"interrupted"):"progressing"===o&&(c.isPaused()?n(l,"paused"):n(l,Math.round(c.getReceivedBytes()/c.getTotalBytes()*100)+"%"))}),c.once("done",(t,r)=>{if(i++,"completed"===r?(a++,n(l,"100%")):n(l,`Download failed: ${r}`),i==e.length){if(a==i){var c=__dirname;(function(){const e=1===parseInt(process.env.ELECTRON_IS_DEV,10);return"ELECTRON_IS_DEV"in process.env?e:process.defaultApp||/node_modules[\\/]electron[\\/]/.test(process.execPath)})()&&(c=p.join(__dirname,"_tmp2"),!h.existsSync(c)&&h.mkdirSync(c)),function e(n,o){h.readdirSync(n).forEach(function(t){var r=p.join(n,t),i=p.join(o,t);h.statSync(r).isDirectory()?r.endsWith(".asar")?_.writeFileSync(i,_.readFileSync(r)):(!h.existsSync(i)&&h.mkdirSync(i),e(r,i)):h.renameSync(r,i)})}(s,c),o(s)}x.webContents.executeJavaScript("complete()")}})}),e.forEach(function(e){n(e,"downloading"),x.webContents.downloadURL(t+e)}),0==e.length&&x.webContents.executeJavaScript("complete()")}const c=o(0),l=c.app,u=c.BrowserWindow,d=o(0).ipcMain,p=o(4),f=o(3),h=o(2),m=o(0).nativeImage,g=c.net,w=c.dialog;var _=o(1);const v=c.globalShortcut;let x,y,S;if(l.on("ready",t),l.on("ready",()=>{v.register("Control+Alt+A",()=>{S||r()})}),l.on("will-quit",()=>{v.unregisterAll()}),l.on("window-all-closed",function(){"darwin"!==process.platform&&l.quit()}),l.on("activate",function(){null===x&&t()}),d.on("openFileDialog",function(e){var n=w.showOpenDialog({properties:["openFile"]});n&&0<n.length&&h.readFile(n[0],function(o,t){if(t){var r=t.toJSON().data,i=n[0].split(/[\\|\/]/gi);e.sender.send("openFileDialog-response",{data:r,name:i[i.length-1]})}})}),d.on("openImageBrowser",function(e,n){global.imageHtml=n.html,y||(y=new u).on("closed",function(){y=null}),y.loadURL(f.format({pathname:p.join(__dirname,"/recent/showImage.html"),protocol:"file:",slashes:!0})),y.setSize(n.width+100,n.height+100),y.center(),y.setAlwaysOnTop(!1),y.show()}),d.on("openCaptureBrowser",function(){r()}),d.on("showCaptureBrowser",function(){S.setFullScreen(!0),S.show()}),d.on("closeCaptureBrowser",function(e,n){S&&(S.minimize(),S.close(),S=null,n&&x.webContents.send("capture-complete"))}),l.dock){var b=m.createFromPath(p.join(__dirname,"/images/traceless.png"));l.dock.setIcon(b)}d.on("messageReceive",function(e,n){l.dock&&l.dock.setBadge(n.total+"")}),d.on("messageRead",function(e,n){l.dock&&(n.total?l.dock.setBadge(n.total+""):l.dock.setBadge(""))});let j,C=!1,k=[];d.on("remoteVersion-request",function(e){a(function(){e.sender.send("remoteVersion-response",j||l.getVersion())})}),d.on("upgrade-request",function(e,n){a(function(e){e?x.loadURL(f.format({pathname:p.join(__dirname,"/index/update.html"),protocol:"file:",slashes:!0})):!1!==n.toIndexIFNot&&x.loadURL(f.format({pathname:p.join(__dirname,"/index/index.html"),protocol:"file:",slashes:!0}))})});let R=new Map;d.on("start-download",function(){s(k)}),d.on("restart",function(){l.relaunch(),l.exit(0)})}]);